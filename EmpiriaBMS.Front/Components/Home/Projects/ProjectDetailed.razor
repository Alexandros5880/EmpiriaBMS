@using EmpiriaBMS.Front.ViewModel.Interfaces
@using EmpiriaBMS.Front.Services
@using Color = Microsoft.Fast.Components.FluentUI.Color
@using EmpiriaBMS.Front.Components.Admin.Projects.Clients

@inject IMapper Mapper
@inject IDataProvider DataProvider
@inject SharedAuthDataService _sharedAuthData
@inject Logging.LoggerManager Logger

<div class="w-96 m-2"
        style="overflow-x: hidden; overflow-y: auto; height: auto; max-height: 70vh;">

    <h3 class="mb-2">Project</h3>

    <!-- Offer -->
    <div class="col-12 row gx-2">
        <div class="col-xl-6 col-lg-6 col-md-12">
            <div>
                Offer<span class="text-danger">*</span>
            </div>
            <div>
                <FluentCombobox @ref="_offerCombo"
                                Autocomplete="ComboboxAutocomplete.Both"
                                Placeholder="Select Offer..."
                                Items="@_offers"
                                Height="200px"
                                Width="100%"
                                TOption="OfferVM"
                                OptionText="@(c => c.Code)"
                                OptionValue="@(c => c.Id.ToString())"
                                @bind-SelectedOption="@Offer" />
            </div>
            @if (!validOffer)
            {
                <div>
                    <span class="text-warning">Field is required!</span>
                </div>
            }
        </div>
    </div>

    <div class="col-12 row gx-2">
        <!-- Name -->
        <div class="col-lg-6 col-md-12">
            <div class="col-12">
                <FluentTextField Style="width: 100%;" @bind-Value="@Content.Name">
                    Name<span class="text-danger">*</span>
                </FluentTextField>
            </div>
            @if (!validName)
            {
                @if (string.IsNullOrEmpty(@Content?.Name))
                {
                    <div class="col-12">
                        <span class="text-warning">Field is required!</span>
                    </div>
                }
            }
        </div>
        <!-- Code-->
        <div class="col-lg-6 col-md-12">
            <div class="col-12">
                <FluentTextField Style="width: 100%;" @bind-Value="@Content.Code">
                    Code<span class="text-danger">*</span>
                </FluentTextField>
            </div>
            @if (!validCode)
            {
                @if (string.IsNullOrEmpty(@Content?.Code))
                {
                    <div class="col-12">
                        <span class="text-warning">Field is required!</span>
                    </div>
                }
            }
        </div>
    </div>

    <div class="col-12 row gx-2">
        <!-- Category -->
        <div class="col-lg-6 col-md-12">
            <div class="col-12">
                Category
            </div>
            <div class="col-12">
                <span>@(_offer?.Category?.Name ?? "--")</span>
            </div>
        </div>
        <!-- SubCategory-->
        <div class="col-lg-6 col-md-12">
            <div class="col-12">
                SubCategory
            </div>
            <div class="col-12">
                <span>@(_offer?.SubCategory?.Name ?? "--")</span>
            </div>
        </div>
    </div>

    <div class="col-12 row gx-2">
        <!-- StartDate -->
        <div class="col-lg-6 col-md-12">
            <FluentDatePicker Style="width: 100%;" @bind-Value="@Content.StartDate" Label="Start Date" />
        </div>
        <!-- DeadLine-->
        <div class="col-lg-6 col-md-12">
            <FluentDatePicker Style="width: 100%;" @bind-Value="@Content.DeadLine" Label="DeadLine" />
        </div>
    </div>

    <div class="col-12 row gx-2">
        <!-- Stage -->
        <div class="col-lg-6 col-md-12">
            <div class="col-12">
                Stage<span class="text-danger">*</span>
            </div>
            <div class="col-12">
                <FluentCombobox @ref="@_stageCombo"
                                Placeholder="Select Stage..."
                                Items="@_stages"
                                Height="200px"
                                Width="100%"
                                TOption="ProjectStageVM"
                                OptionText="@(c => c.Name)"
                                OptionValue="@(c => c.Id.ToString())"
                                @bind-SelectedOption="@Stage" />
            </div>
            @if (!validStage)
            {
                <div class="col-12">
                    <span class="text-warning">Field is required!</span>
                </div>
            }
        </div>
        <!-- EstimatedHours -->
        <div class="col-lg-6 col-md-12">
            <div class="col-12">
                EstimatedHours<span class="text-danger">*</span>
            </div>
            <div class="col-12">
                <FluentNumberField Style="width: 100%;" @bind-Value="@Content.EstimatedHours" Min="0" />
            </div>
            @if (!validEstHours)
            {
                <div class="col-12">
                    <span class="text-warning">Field is required!</span>
                </div>
            }       
        </div>
    </div>

    <div class="col-12 row gx-2">
        <!-- Project Manager -->
        <div class="col-lg-6 col-md-12 mb-2">
            <div class="col-12">
                Project Manager<span class="text-danger">*</span>
            </div>
            <div class="col-12">
                <FluentCombobox @ref="@_pmCombo"
                                Autocomplete="ComboboxAutocomplete.Both"
                                Placeholder="Select PM..."
                                Items="@_pms"
                                Height="200px"
                                Width="100%"
                                TOption="UserVM"
                                OptionText="@(c => c.FullName)"
                                OptionValue="@(c => c.Id.ToString())"
                                @bind-SelectedOption="@Pm" />
            </div>
            @if (!validPm)
            {
                <div class="col-12">
                    <span class="text-warning">Field is required!</span>
                </div>
            }
        </div>
    </div>

    <!-- Description -->
    <div class="col-12 mb-5">
        <FluentTextArea Style="width:100%;" @bind-Value="@Content.Description" Rows="2" Resize="TextAreaResize.Vertical">Description:</FluentTextArea>
    </div>

    <!-- Action Buttons -->
    @if (DisplayActions)
    {
        <div class="row mt-3 mb-3">
            <div class="col-12">
                <FluentButton IconStart="@(new Icons.Regular.Size16.Save())"
                                OnClick="@(async () => await SaveAsync())"
                                Style="float: right;"
                                Disabled=false>
                    @(_isNew ? "Add" : "Update")
                </FluentButton>
            </div>
        </div>
    }

</div>
